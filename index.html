<!doctype html>
<html lang="en-us">
<head>
<meta charset="utf-8">
<title>Super Mario 64</title>
<style>
body, html{
  margin: 0;
  padding: 0;
  width: 100vw;
  min-height: 100vh;
  background-color: #111;
  font-family: Arial, Helvetica, sans-serif;
  color: white;
  image-rendering: pixelated;
  scrollbar-width: none;
}
::-webkit-scrollbar { display: none; }

#container {
  width: 100vw;
  height: 100vh;
  display: flex;
  align-items: center;
  justify-content: center;
}

canvas {
  width: 100vw;
  height: 100vh;
}

#mobile-controls {
  position: fixed;
  bottom: 10px;
  left: 0;
  width: 100%;
  display: flex;
  justify-content: space-between;
  pointer-events: none;
  z-index: 999;
}

.dpad, .cstick, .buttons, .start-btn {
  pointer-events: auto;
  display: flex;
  gap: 10px;
}

.dpad, .cstick {
  flex-direction: column;
  margin-left: 10px;
}

.buttons {
  flex-direction: column;
  margin-right: 10px;
}

.start-btn {
  position: fixed;
  top: 10px;
  right: 10px;
  pointer-events: auto;
}

.btn {
  width: 60px;
  height: 60px;
  border-radius: 50%;
  background: rgba(255,255,255,0.15);
  color: white;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 20px;
  user-select: none;
  touch-action: none;
}
.btn:active {
  background: rgba(255,255,255,0.4);
}
</style>
</head>
<body>

<div id="container">
  <canvas class="emscripten" id="canvas"></canvas>
</div>

<!-- Mobile Controls -->
<div id="mobile-controls">
  <div class="dpad">
    <div class="btn" data-key="w">↑</div>
    <div class="btn" data-key="a">←</div>
    <div class="btn" data-key="s">↓</div>
    <div class="btn" data-key="d">→</div>
  </div>

  <div class="cstick">
    <div class="btn" data-key="ArrowUp">↑</div>
    <div class="btn" data-key="ArrowLeft">←</div>
    <div class="btn" data-key="ArrowDown">↓</div>
    <div class="btn" data-key="ArrowRight">→</div>
  </div>

  <div class="buttons">
    <div class="btn" data-key="l">A</div>
    <div class="btn" data-key=",">B</div>
    <div class="btn" data-key="k">Z</div>
    <div class="btn" data-key="ShiftRight">R</div>
  </div>

  <div class="start-btn">
    <div class="btn" data-key=" ">Start</div>
  </div>
</div>

<script type='text/javascript'>
var Module = {
  preRun: [],
  postRun: [],
  print: function(text) { console.log(text); },
  printErr: function(text) { console.error(text); },
  canvas: (function() {
      var canvas = document.getElementById('canvas');
      canvas.width = window.innerWidth;
      canvas.height = window.innerHeight;
      canvas.addEventListener("webglcontextlost", function(e) {
          alert('WebGL context lost. You will need to reload the page.');
          e.preventDefault();
      }, false);
      return canvas;
  })(),
  setStatus: function(text) {}
};

// Mobile touch controls
const activeKeys = new Set();
document.querySelectorAll('.btn').forEach(btn => {
  const key = btn.dataset.key;
  btn.addEventListener('touchstart', e => {
    e.preventDefault();
    if (!activeKeys.has(key)) {
      activeKeys.add(key);
      document.dispatchEvent(new KeyboardEvent('keydown', {key:key, code:key}));
    }
  });
  btn.addEventListener('touchend', e => {
    e.preventDefault();
    if (activeKeys.has(key)) {
      activeKeys.delete(key);
      document.dispatchEvent(new KeyboardEvent('keyup', {key:key, code:key}));
    }
  });
  btn.addEventListener('touchcancel', e => {
    e.preventDefault();
    if (activeKeys.has(key)) {
      activeKeys.delete(key);
      document.dispatchEvent(new KeyboardEvent('keyup', {key:key, code:key}));
    }
  });
});
</script>

<script async type="text/javascript" src="sm64.us.f3dex2e.js"></script>
</body>
</html>
